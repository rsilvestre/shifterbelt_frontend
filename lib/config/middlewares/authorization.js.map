{"version":3,"sources":["../../../src/config/middlewares/authorization.js"],"names":[],"mappings":";;;;;;;AAKA,OAAO,CAAC,aAAa,GAAG,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAChD,cAAY,CAAC;;AAEb,MAAI,GAAG,CAAC,eAAe,EAAE,EAAE;AACzB,WAAO,IAAI,EAAE,CAAC;GACf;AACD,MAAI,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE;AACxB,OAAG,CAAC,OAAO,CAAC,QAAQ,GAAG,GAAG,CAAC,WAAW,CAAC;GACxC;AACD,KAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;CACxB,CAAC;;;;;;AAMF,OAAO,CAAC,IAAI,GAAG;AACb,kBAAgB,EAAE,0BAAU,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC1C,gBAAY,CAAC;;AAEb,QAAI,GAAG,CAAC,OAAO,CAAC,EAAE,KAAK,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE;AAClC,SAAG,CAAC,KAAK,CAAC,MAAM,EAAE,wBAAwB,CAAC,CAAC;AAC5C,aAAO,GAAG,CAAC,QAAQ,CAAC,SAAS,GAAG,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KACjD;AACD,QAAI,EAAE,CAAC;GACR;CACF,CAAC;;;;;;AAMF,OAAO,CAAC,OAAO,GAAG;AAChB,kBAAgB,EAAE,0BAAU,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC1C,gBAAY,CAAC;;AAEb,QAAI,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,KAAK,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE;AACvC,SAAG,CAAC,KAAK,CAAC,MAAM,EAAE,wBAAwB,CAAC,CAAC;AAC5C,aAAO,GAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KACpD;AACD,QAAI,EAAE,CAAC;GACR;CACF,CAAC;;;;;;AAMF,OAAO,CAAC,WAAW,GAAG;AACpB,kBAAgB,EAAE,0BAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AACzC,gBAAY,CAAC;;AAEb,QAAI,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE;AACnD,SAAG,CAAC,KAAK,CAAC,MAAM,EAAE,wBAAwB,CAAC,CAAC;AAC5C,aAAO,GAAG,CAAC,QAAQ,CAAC,gBAAgB,GAAG,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;KAC5D;AACD,QAAI,EAAE,CAAC;GACR;CACF,CAAC;;;;;;AAMF,OAAO,CAAC,OAAO,GAAG;AAChB,kBAAgB,EAAE,0BAAU,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC1C,gBAAY,CAAC;;;;AAIb,QAAI,GAAG,CAAC,IAAI,CAAC,EAAE,KAAK,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,GAAG,CAAC,IAAI,CAAC,EAAE,KAAK,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE;AAC9E,UAAI,EAAE,CAAC;KACR,MAAM;AACL,SAAG,CAAC,KAAK,CAAC,MAAM,EAAE,wBAAwB,CAAC,CAAC;AAC5C,SAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KAC7C;GACF;CACF,CAAC","file":"authorization.js","sourcesContent":["\n/*\n *  Generic require login routing middleware\n */\n\nexports.requiresLogin = function (req, res, next) {\n  \"use strict\";\n\n  if (req.isAuthenticated()) {\n    return next();\n  }\n  if (req.method === 'GET') {\n    req.session.returnTo = req.originalUrl;\n  }\n  res.redirect('/login');\n};\n\n/*\n *  User authorization routing middleware\n */\n\nexports.user = {\n  hasAuthorization: function (req, res, next) {\n    \"use strict\";\n\n    if (req.profile.id !== req.user.id) {\n      req.flash('info', 'You are not authorized');\n      return res.redirect('/users/' + req.profile.id);\n    }\n    next();\n  }\n};\n\n/**\n *  Article authorization routing middleware\n */\n\nexports.article = {\n  hasAuthorization: function (req, res, next) {\n    \"use strict\";\n\n    if (req.article.user.id !== req.user.id) {\n      req.flash('info', 'You are not authorized');\n      return res.redirect('/articles/' + req.article.id);\n    }\n    next();\n  }\n};\n\n/**\n * Application authorization routing middleware\n */\n\nexports.application = {\n  hasAuthorization: function(req, res, next) {\n    \"use strict\";\n\n    if (req.application.users.indexOf(req.user.id) > -1) {\n      req.flash('info', 'You are not authorized');\n      return res.redirect(\"/applications/\" + req.application.id);\n    }\n    next();\n  }\n};\n\n/**\n * Comment authorization routing middleware\n */\n\nexports.comment = {\n  hasAuthorization: function (req, res, next) {\n    \"use strict\";\n\n    // if the current user is comment owner or article owner\n    // give them authority to delete\n    if (req.user.id === req.comment.user.id || req.user.id === req.article.user.id) {\n      next();\n    } else {\n      req.flash('info', 'You are not authorized');\n      res.redirect('/articles/' + req.article.id);\n    }\n  }\n};\n"]}