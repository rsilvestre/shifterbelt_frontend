{"version":3,"sources":["../../../src/app/controllers/articles.js"],"names":[],"mappings":"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","file":"articles.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar mongoose = require('mongoose');\nvar Article = mongoose.model('Article');\nvar utils = require('../../lib/utils');\nvar extend = require('util')._extend;\n\n/**\n * Load\n */\n\nexports.load = function (req, res, next, id){\n  var User = mongoose.model('User');\n\n  Article.load(id, function (err, article) {\n    if (err) {\n      return next(err);\n    }\n    if (!article) {\n      return next(new Error('not found'));\n    }\n    req.article = article;\n    next();\n  });\n};\n\n/**\n * List\n */\n\nexports.index = function (req, res){\n  var page = (req.params.page > 0 ? req.params.page : 1) - 1;\n  var perPage = 30;\n  var options = {\n    perPage: perPage,\n    page: page\n  };\n\n  Article.list(options, function (err, articles) {\n    if (err) return res.render('500');\n    Article.count().exec(function (err, count) {\n      res.render('articles/index', {\n        title: 'Articles',\n        articles: articles,\n        page: page + 1,\n        pages: Math.ceil(count / perPage)\n      });\n    });\n  });\n};\n\n/**\n * New article\n */\n\nexports.new = function (req, res){\n  res.render('articles/new', {\n    title: 'New Article',\n    article: new Article({})\n  });\n};\n\n/**\n * Create an article\n * Upload an image\n */\n\nexports.create = function (req, res) {\n  var article = new Article(req.body);\n  var images = req.files.image\n    ? [req.files.image]\n    : undefined;\n\n  article.user = req.user;\n  article.uploadAndSave(images, function (err) {\n    if (!err) {\n      req.flash('success', 'Successfully created article!');\n      return res.redirect('/articles/'+article._id);\n    }\n    console.log(err);\n    res.render('articles/new', {\n      title: 'New Article',\n      article: article,\n      errors: utils.errors(err.errors || err)\n    });\n  });\n};\n\n/**\n * Edit an article\n */\n\nexports.edit = function (req, res) {\n  res.render('articles/edit', {\n    title: 'Edit ' + req.article.title,\n    article: req.article\n  });\n};\n\n/**\n * Update article\n */\n\nexports.update = function (req, res){\n  var article = req.article;\n  var images = req.files.image\n    ? [req.files.image]\n    : undefined;\n\n  // make sure no one changes the user\n  delete req.body.user;\n  article = extend(article, req.body);\n\n  article.uploadAndSave(images, function (err) {\n    if (!err) {\n      return res.redirect('/articles/' + article._id);\n    }\n\n    res.render('articles/edit', {\n      title: 'Edit Article',\n      article: article,\n      errors: utils.errors(err.errors || err)\n    });\n  });\n};\n\n/**\n * Show\n */\n\nexports.show = function (req, res){\n  res.render('articles/show', {\n    title: req.article.title,\n    article: req.article\n  });\n};\n\n/**\n * Delete an article\n */\n\nexports.destroy = function (req, res){\n  var article = req.article;\n  article.remove(function (err){\n    req.flash('info', 'Deleted successfully');\n    res.redirect('/articles');\n  });\n};\n"]}